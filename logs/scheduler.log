2025-11-02 12:54:13,700 INFO DayFlow scheduler starting (tz=Europe/London, dry_run=False, force=True)
2025-11-02 12:54:14,535 INFO Supabase client created.
2025-11-02 12:54:14,536 INFO Run date = 2025-11-02 (Europe/London local)
2025-11-02 12:54:16,127 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/task_templates?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39 "HTTP/2 200 OK"
2025-11-02 12:54:16,130 INFO templates: fetched 11 row(s) for user_id=3c877140-9539-47b9-898a-45eeab392e39
2025-11-02 12:54:16,130 INFO templates: columns=['id', 'user_id', 'title', 'description', 'kind', 'repeat', 'repeat_day', 'suggested_duration_minutes', 'origin_source', 'created_at', 'updated_at', 'active', 'repeat_interval', 'repeat_days', 'day_of_month', 'timezone', 'repeat_unit', 'start_time', 'duration_minutes', 'is_routine', 'is_fixed', 'is_appointment', 'notes', 'date', 'priority', 'window_start_local', 'window_end_local']
2025-11-02 12:54:16,133 INFO templates: preview (up to 5)=[{'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none', 'repeat': None, 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 5, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 60, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 45, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'c8e62685-8b13-4922-92fe-420d38ba0d90', 'title': 'code d2', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 120, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '209e8601-0b9f-42de-8a50-6406327d06fa', 'title': 'coffee', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': '11:00:00', 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': True, 'timezone': 'Europe/London', 'date': None}]
2025-11-02 12:54:16,393 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=in.%282025-11-01%2C2025-11-02%29 "HTTP/2 200 OK"
2025-11-02 12:54:16,569 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-02 "HTTP/2 200 OK"
2025-11-02 12:54:16,770 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks_archive?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-02 "HTTP/2 200 OK"
2025-11-02 12:54:16,772 INFO Excluding 8 one-off template(s) already used on a different day
2025-11-02 12:54:16,785 INFO Instantiation report (3): [{'template_id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-02', 'today': '2025-11-02', 'start_local': '2025-11-02T09:00:00+00:00', 'start_utc': '2025-11-02T09:00:00+00:00', 'duration_min': 5, 'reason': 'one-off today'}, {'template_id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'none', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-02', 'today': '2025-11-02', 'start_local': '2025-11-02T09:00:00+00:00', 'start_utc': '2025-11-02T09:00:00+00:00', 'duration_min': 60, 'reason': 'one-off today'}, {'template_id': '7378ee44-b1e8-446d-a095-bfa6aa8c2b8b', 'title': 'routine test Wednesday', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-02', 'today': '2025-11-02', 'start_local': '2025-11-02T11:00:00+00:00', 'start_utc': '2025-11-02T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}]
2025-11-02 12:54:16,785 INFO Skip report: none
2025-11-02 12:54:16,790 INFO Prepared 3 instance(s) for 2025-11-02
2025-11-02 12:54:16,790 INFO Prepared 3 instance(s) for 2025-11-02 (post-dedupe)
2025-11-02 12:54:16,790 INFO Preprocessed 3 instance(s).
C:\Projects\dayflow-scheduler\dayflow\planner.py:1246: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  tasks_df['is_floating'] = tasks_df['is_floating'].fillna(False).astype(bool)
2025-11-02 12:54:16,937 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-02 12:54:17,043 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-02 12:54:17,336 INFO HTTP Request: POST https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?on_conflict=user_id%2Clocal_date%2Ctemplate_id&columns=%22template_id%22%2C%22priority%22%2C%22title%22%2C%22is_appointment%22%2C%22start_time%22%2C%22duration_minutes%22%2C%22is_fixed%22%2C%22end_time%22%2C%22local_date%22%2C%22user_id%22%2C%22is_routine%22%2C%22timezone%22 "HTTP/2 200 OK"
2025-11-02 12:54:17,337 INFO Scheduled 3 item(s).

[Scheduler Env Preflight]
  SUPABASE_URL: https:…e.co
  SUPABASE_SERVICE_ROLE_KEY: <missing>
  SUPABASE_SERVICE_KEY:      eyJhbG…SxCc
[Env OK]

Filtered out 0 template task(s).
schedule_day candidates=3 filtered=3 allowed_cols=['created_at', 'date', 'description', 'duration_minutes', 'end_time', 'id', 'is_appointment', 'is_completed', 'is_deleted', 'is_fixed', 'is_routine', 'last_completed_date', 'local_date', 'origin_template_id', 'priority', 'start_time', 'template_id', 'timezone', 'title', 'updated_at', 'user_id']
schedule_day first row sample: {'duration_minutes': 5,
 'end_time': '2025-11-02T07:05:00+00:00',
 'is_appointment': False,
 'is_fixed': False,
 'is_routine': False,
 'local_date': '2025-11-02',
 'priority': 3,
 'start_time': '2025-11-02T07:00:00+00:00',
 'template_id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2',
 'timezone': 'Europe/London',
 'title': 'CANARY – template',
 'user_id': '3c877140-9539-47b9-898a-45eeab392e39'}
schedule_day: WRITING 3 row(s) to scheduled_tasks for 2025-11-02
schedule_day upserted=3 attempted=3 conflict_target=user_id,local_date,template_id
[02/11/2025 12:54:17.43] DONE 
2025-11-02 12:57:58,601 INFO DayFlow scheduler starting (tz=Europe/London, dry_run=False, force=False)
2025-11-02 12:57:59,405 INFO Supabase client created.
2025-11-02 12:57:59,405 INFO Run date = 2025-11-02 (Europe/London local)
2025-11-02 12:58:00,031 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/task_templates?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39 "HTTP/2 200 OK"
2025-11-02 12:58:00,037 INFO templates: fetched 11 row(s) for user_id=3c877140-9539-47b9-898a-45eeab392e39
2025-11-02 12:58:00,037 INFO templates: columns=['id', 'user_id', 'title', 'description', 'kind', 'repeat', 'repeat_day', 'suggested_duration_minutes', 'origin_source', 'created_at', 'updated_at', 'active', 'repeat_interval', 'repeat_days', 'day_of_month', 'timezone', 'repeat_unit', 'start_time', 'duration_minutes', 'is_routine', 'is_fixed', 'is_appointment', 'notes', 'date', 'priority', 'window_start_local', 'window_end_local']
2025-11-02 12:58:00,041 INFO templates: preview (up to 5)=[{'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none', 'repeat': None, 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 5, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 60, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 45, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'c8e62685-8b13-4922-92fe-420d38ba0d90', 'title': 'code d2', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 120, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '209e8601-0b9f-42de-8a50-6406327d06fa', 'title': 'coffee', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': '11:00:00', 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': True, 'timezone': 'Europe/London', 'date': None}]
2025-11-02 12:58:00,148 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=in.%282025-11-01%2C2025-11-02%29 "HTTP/2 200 OK"
2025-11-02 12:58:00,295 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-02 "HTTP/2 200 OK"
2025-11-02 12:58:00,335 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks_archive?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-02 "HTTP/2 200 OK"
2025-11-02 12:58:00,337 INFO Excluding 8 one-off template(s) already used on a different day
2025-11-02 12:58:00,350 INFO Instantiation report (3): [{'template_id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-02', 'today': '2025-11-02', 'start_local': '2025-11-02T09:00:00+00:00', 'start_utc': '2025-11-02T09:00:00+00:00', 'duration_min': 5, 'reason': 'one-off today'}, {'template_id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'none', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-02', 'today': '2025-11-02', 'start_local': '2025-11-02T09:00:00+00:00', 'start_utc': '2025-11-02T09:00:00+00:00', 'duration_min': 60, 'reason': 'one-off today'}, {'template_id': '7378ee44-b1e8-446d-a095-bfa6aa8c2b8b', 'title': 'routine test Wednesday', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-02', 'today': '2025-11-02', 'start_local': '2025-11-02T11:00:00+00:00', 'start_utc': '2025-11-02T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}]
2025-11-02 12:58:00,350 INFO Skip report: none
2025-11-02 12:58:00,355 INFO Prepared 3 instance(s) for 2025-11-02
2025-11-02 12:58:00,355 INFO Prepared 3 instance(s) for 2025-11-02 (post-dedupe)
2025-11-02 12:58:00,355 INFO Preprocessed 3 instance(s).
C:\Projects\dayflow-scheduler\dayflow\planner.py:1246: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  tasks_df['is_floating'] = tasks_df['is_floating'].fillna(False).astype(bool)
2025-11-02 12:58:00,473 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-02 12:58:00,516 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-02 12:58:00,634 INFO HTTP Request: POST https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?on_conflict=user_id%2Clocal_date%2Ctemplate_id&columns=%22local_date%22%2C%22title%22%2C%22priority%22%2C%22is_fixed%22%2C%22template_id%22%2C%22is_routine%22%2C%22is_appointment%22%2C%22duration_minutes%22%2C%22user_id%22%2C%22start_time%22%2C%22timezone%22%2C%22end_time%22 "HTTP/2 200 OK"
2025-11-02 12:58:00,636 INFO Scheduled 3 item(s).

[Scheduler Env Preflight]
  SUPABASE_URL: https:…e.co
  SUPABASE_SERVICE_ROLE_KEY: <missing>
  SUPABASE_SERVICE_KEY:      eyJhbG…SxCc
[Env OK]

Filtered out 0 template task(s).
schedule_day candidates=3 filtered=3 allowed_cols=['created_at', 'date', 'description', 'duration_minutes', 'end_time', 'id', 'is_appointment', 'is_completed', 'is_deleted', 'is_fixed', 'is_routine', 'last_completed_date', 'local_date', 'origin_template_id', 'priority', 'start_time', 'template_id', 'timezone', 'title', 'updated_at', 'user_id']
schedule_day first row sample: {'duration_minutes': 5,
 'end_time': '2025-11-02T07:05:00+00:00',
 'is_appointment': False,
 'is_fixed': False,
 'is_routine': False,
 'local_date': '2025-11-02',
 'priority': 3,
 'start_time': '2025-11-02T07:00:00+00:00',
 'template_id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2',
 'timezone': 'Europe/London',
 'title': 'CANARY – template',
 'user_id': '3c877140-9539-47b9-898a-45eeab392e39'}
schedule_day: WRITING 3 row(s) to scheduled_tasks for 2025-11-02
schedule_day upserted=3 attempted=3 conflict_target=user_id,local_date,template_id
[02/11/2025 12:58:00.77] DONE 
2025-11-03 07:05:02,914 INFO DayFlow scheduler starting (tz=Europe/London, dry_run=False, force=False)
2025-11-03 07:05:03,799 INFO Supabase client created.
2025-11-03 07:05:03,799 INFO Run date = 2025-11-03 (Europe/London local)
2025-11-03 07:05:05,927 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/task_templates?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39 "HTTP/2 200 OK"
2025-11-03 07:05:05,929 INFO templates: fetched 11 row(s) for user_id=3c877140-9539-47b9-898a-45eeab392e39
2025-11-03 07:05:05,929 INFO templates: columns=['id', 'user_id', 'title', 'description', 'kind', 'repeat', 'repeat_day', 'suggested_duration_minutes', 'origin_source', 'created_at', 'updated_at', 'active', 'repeat_interval', 'repeat_days', 'day_of_month', 'timezone', 'repeat_unit', 'start_time', 'duration_minutes', 'is_routine', 'is_fixed', 'is_appointment', 'notes', 'date', 'priority', 'window_start_local', 'window_end_local']
2025-11-03 07:05:05,932 INFO templates: preview (up to 5)=[{'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none', 'repeat': None, 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 5, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 60, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 45, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'c8e62685-8b13-4922-92fe-420d38ba0d90', 'title': 'code d2', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 120, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '209e8601-0b9f-42de-8a50-6406327d06fa', 'title': 'coffee', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': '11:00:00', 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': True, 'timezone': 'Europe/London', 'date': None}]
2025-11-03 07:05:06,102 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=in.%282025-11-02%2C2025-11-03%29 "HTTP/2 200 OK"
2025-11-03 07:05:06,240 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-03 "HTTP/2 200 OK"
2025-11-03 07:05:06,345 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks_archive?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-03 "HTTP/2 200 OK"
2025-11-03 07:05:06,347 INFO Excluding 10 one-off template(s) already used on a different day
2025-11-03 07:05:06,357 INFO Instantiation report (1): [{'template_id': '7378ee44-b1e8-446d-a095-bfa6aa8c2b8b', 'title': 'routine test Wednesday', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-03', 'today': '2025-11-03', 'start_local': '2025-11-03T11:00:00+00:00', 'start_utc': '2025-11-03T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}]
2025-11-03 07:05:06,357 INFO Skip report: none
2025-11-03 07:05:06,362 INFO Prepared 1 instance(s) for 2025-11-03
2025-11-03 07:05:06,362 INFO Prepared 1 instance(s) for 2025-11-03 (post-dedupe)
2025-11-03 07:05:06,362 INFO Preprocessed 1 instance(s).
2025-11-03 07:05:06,459 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-03 07:05:06,511 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-03 07:05:06,705 INFO HTTP Request: POST https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?on_conflict=user_id%2Clocal_date%2Ctemplate_id&columns=%22user_id%22%2C%22timezone%22%2C%22local_date%22%2C%22priority%22%2C%22is_appointment%22%2C%22start_time%22%2C%22title%22%2C%22is_fixed%22%2C%22end_time%22%2C%22duration_minutes%22%2C%22template_id%22%2C%22is_routine%22 "HTTP/2 201 Created"
2025-11-03 07:05:06,705 INFO Scheduled 1 item(s).

[Scheduler Env Preflight]
  SUPABASE_URL: https:…e.co
  SUPABASE_SERVICE_ROLE_KEY: <missing>
  SUPABASE_SERVICE_KEY:      eyJhbG…SxCc
[Env OK]

Filtered out 0 template task(s).
schedule_day candidates=1 filtered=1 allowed_cols=['created_at', 'date', 'description', 'duration_minutes', 'end_time', 'id', 'is_appointment', 'is_completed', 'is_deleted', 'is_fixed', 'is_routine', 'last_completed_date', 'local_date', 'origin_template_id', 'priority', 'start_time', 'template_id', 'timezone', 'title', 'updated_at', 'user_id']
schedule_day first row sample: {'duration_minutes': 30,
 'end_time': '2025-11-03T11:30:00+00:00',
 'is_appointment': False,
 'is_fixed': False,
 'is_routine': True,
 'local_date': '2025-11-03',
 'priority': 3,
 'start_time': '2025-11-03T11:00:00+00:00',
 'template_id': '7378ee44-b1e8-446d-a095-bfa6aa8c2b8b',
 'timezone': 'Europe/London',
 'title': 'routine test Wednesday',
 'user_id': '3c877140-9539-47b9-898a-45eeab392e39'}
schedule_day: WRITING 1 row(s) to scheduled_tasks for 2025-11-03
schedule_day upserted=1 attempted=1 conflict_target=user_id,local_date,template_id
[03/11/2025  7:05:06.79] DONE 
2025-11-03 09:21:24,004 INFO DayFlow scheduler starting (tz=Europe/London, dry_run=False, force=False)
2025-11-03 09:21:24,910 INFO Supabase client created.
2025-11-03 09:21:24,910 INFO Run date = 2025-11-03 (Europe/London local)
2025-11-03 09:21:26,889 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/task_templates?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39 "HTTP/2 200 OK"
2025-11-03 09:21:26,892 INFO templates: fetched 11 row(s) for user_id=3c877140-9539-47b9-898a-45eeab392e39
2025-11-03 09:21:26,892 INFO templates: columns=['id', 'user_id', 'title', 'description', 'kind', 'repeat', 'repeat_day', 'suggested_duration_minutes', 'origin_source', 'created_at', 'updated_at', 'active', 'repeat_interval', 'repeat_days', 'day_of_month', 'timezone', 'repeat_unit', 'start_time', 'duration_minutes', 'is_routine', 'is_fixed', 'is_appointment', 'notes', 'date', 'priority', 'window_start_local', 'window_end_local']
2025-11-03 09:21:26,895 INFO templates: preview (up to 5)=[{'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none', 'repeat': None, 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 5, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 60, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 45, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'c8e62685-8b13-4922-92fe-420d38ba0d90', 'title': 'code d2', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 120, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '209e8601-0b9f-42de-8a50-6406327d06fa', 'title': 'coffee', 'repeat_unit': 'none', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': '11:00:00', 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': True, 'timezone': 'Europe/London', 'date': None}]
2025-11-03 09:21:27,028 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=in.%282025-11-02%2C2025-11-03%29 "HTTP/2 200 OK"
2025-11-03 09:21:27,146 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-03 "HTTP/2 200 OK"
2025-11-03 09:21:27,281 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks_archive?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-03 "HTTP/2 200 OK"
2025-11-03 09:21:27,283 INFO Excluding 10 one-off template(s) already used on a different day
2025-11-03 09:21:27,292 INFO Instantiation report (1): [{'template_id': '7378ee44-b1e8-446d-a095-bfa6aa8c2b8b', 'title': 'routine test Wednesday', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-03', 'today': '2025-11-03', 'start_local': '2025-11-03T11:00:00+00:00', 'start_utc': '2025-11-03T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}]
2025-11-03 09:21:27,292 INFO Skip report: none
2025-11-03 09:21:27,298 INFO Prepared 1 instance(s) for 2025-11-03
2025-11-03 09:21:27,298 INFO Prepared 1 instance(s) for 2025-11-03 (post-dedupe)
2025-11-03 09:21:27,298 INFO Preprocessed 1 instance(s).
2025-11-03 09:21:27,427 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-03 09:21:27,531 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-03 09:21:27,790 INFO HTTP Request: POST https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?on_conflict=user_id%2Clocal_date%2Ctemplate_id&columns=%22template_id%22%2C%22start_time%22%2C%22title%22%2C%22priority%22%2C%22is_fixed%22%2C%22duration_minutes%22%2C%22end_time%22%2C%22is_appointment%22%2C%22is_routine%22%2C%22local_date%22%2C%22user_id%22%2C%22timezone%22 "HTTP/2 200 OK"
2025-11-03 09:21:27,791 INFO Scheduled 1 item(s).

[Scheduler Env Preflight]
  SUPABASE_URL: https:…e.co
  SUPABASE_SERVICE_ROLE_KEY: sb_sec…KSTL
  SUPABASE_SERVICE_KEY:      sb_sec…KSTL
[Env OK]

Filtered out 0 template task(s).
schedule_day candidates=1 filtered=1 allowed_cols=['created_at', 'date', 'description', 'duration_minutes', 'end_time', 'id', 'is_appointment', 'is_completed', 'is_deleted', 'is_fixed', 'is_routine', 'last_completed_date', 'local_date', 'origin_template_id', 'priority', 'start_time', 'template_id', 'timezone', 'title', 'updated_at', 'user_id']
schedule_day first row sample: {'duration_minutes': 30,
 'end_time': '2025-11-03T11:30:00+00:00',
 'is_appointment': False,
 'is_fixed': False,
 'is_routine': True,
 'local_date': '2025-11-03',
 'priority': 3,
 'start_time': '2025-11-03T11:00:00+00:00',
 'template_id': '7378ee44-b1e8-446d-a095-bfa6aa8c2b8b',
 'timezone': 'Europe/London',
 'title': 'routine test Wednesday',
 'user_id': '3c877140-9539-47b9-898a-45eeab392e39'}
schedule_day: WRITING 1 row(s) to scheduled_tasks for 2025-11-03
schedule_day upserted=1 attempted=1 conflict_target=user_id,local_date,template_id
[03/11/2025  9:21:27.88] DONE 
2025-11-04 07:05:02,841 INFO DayFlow scheduler starting (tz=Europe/London, dry_run=False, force=False)
2025-11-04 07:05:03,718 INFO Supabase client created.
2025-11-04 07:05:03,718 INFO Run date = 2025-11-04 (Europe/London local)
2025-11-04 07:05:05,872 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/task_templates?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39 "HTTP/2 200 OK"
2025-11-04 07:05:05,875 INFO templates: fetched 13 row(s) for user_id=3c877140-9539-47b9-898a-45eeab392e39
2025-11-04 07:05:05,875 INFO templates: columns=['id', 'user_id', 'title', 'description', 'kind', 'repeat', 'repeat_day', 'suggested_duration_minutes', 'origin_source', 'created_at', 'updated_at', 'active', 'repeat_interval', 'repeat_days', 'day_of_month', 'timezone', 'repeat_unit', 'start_time', 'duration_minutes', 'is_routine', 'is_fixed', 'is_appointment', 'notes', 'date', 'priority', 'window_start_local', 'window_end_local']
2025-11-04 07:05:05,878 INFO templates: preview (up to 5)=[{'id': '18390d4d-1798-4d3c-ab71-521ad9563276', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [1], 'start_time': None, 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'd2671250-aa7c-413c-9e52-76fb6b53f508', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [0], 'start_time': None, 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none', 'repeat': None, 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 5, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'daily', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 60, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'daily', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 45, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}]
2025-11-04 07:05:06,089 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=in.%282025-11-03%2C2025-11-04%29 "HTTP/2 200 OK"
2025-11-04 07:05:06,253 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-04 "HTTP/2 200 OK"
2025-11-04 07:05:06,431 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks_archive?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-04 "HTTP/2 200 OK"
2025-11-04 07:05:06,433 INFO One-off block list (template_id,title,repeat_unit): [{'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none'}, {'id': '237500d2-267b-498d-a840-3d907a94e7db', 'title': 'High priority task', 'repeat_unit': 'none'}, {'id': '642b62d0-4a8b-4ffe-bc1a-13cdcdad353d', 'title': 'Low priority task', 'repeat_unit': 'none'}, {'id': '5b16ec1e-8682-4287-8c57-9ada81185b62', 'title': 'Mr Roberts', 'repeat_unit': 'none'}, {'id': '0b2ea488-d48d-41fc-abb7-42f08cf80a8b', 'title': 'test floating task', 'repeat_unit': 'none'}]
2025-11-04 07:05:06,433 INFO Excluding 5 one-off template(s) already used on a different day
2025-11-04 07:05:06,521 INFO Instantiation report (7): [{'template_id': '18390d4d-1798-4d3c-ab71-521ad9563276', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [1], 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 30, 'reason': 'one-off today'}, {'template_id': 'd2671250-aa7c-413c-9e52-76fb6b53f508', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [0], 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 30, 'reason': 'one-off today'}, {'template_id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 60, 'reason': 'daily'}, {'template_id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 45, 'reason': 'daily'}, {'template_id': 'c8e62685-8b13-4922-92fe-420d38ba0d90', 'title': 'code d2', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 120, 'reason': 'daily'}, {'template_id': '209e8601-0b9f-42de-8a50-6406327d06fa', 'title': 'coffee', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T11:00:00+00:00', 'start_utc': '2025-11-04T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}, {'template_id': '7378ee44-b1e8-446d-a095-bfa6aa8c2b8b', 'title': 'routine test Wednesday', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T11:00:00+00:00', 'start_utc': '2025-11-04T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}]
2025-11-04 07:05:06,521 INFO Skip report (1): [{'template_id': 'e4dc2e80-0bda-49e7-80b0-3205b5285b13', 'title': 'Spraying', 'reason': 'weekly not due today (dow=1, days=[4])'}]
2025-11-04 07:05:06,521 INFO Skip summary: {'weekly not due today (dow=1, days=[4])': 1}
2025-11-04 07:05:06,528 INFO Prepared 7 instance(s) for 2025-11-04
2025-11-04 07:05:06,528 INFO Prepared 7 instance(s) for 2025-11-04 (post-dedupe)
2025-11-04 07:05:06,529 INFO Preprocessed 7 instance(s).
C:\Projects\dayflow-scheduler\dayflow\planner.py:1251: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  tasks_df['is_floating'] = tasks_df['is_floating'].fillna(False).astype(bool)
2025-11-04 07:05:06,544 ERROR Runner crashed
Traceback (most recent call last):
  File "C:\Users\Mike\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'task'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Projects\dayflow-scheduler\dayflow\scheduler_main.py", line 349, in <module>
    sys.exit(main())
             ^^^^^^
  File "C:\Projects\dayflow-scheduler\dayflow\scheduler_main.py", line 331, in main
    schedule = schedule_day(
               ^^^^^^^^^^^^^
  File "C:\Projects\dayflow-scheduler\dayflow\planner.py", line 1456, in schedule_day
    print(f" - {task['task']} (Priority {task.get('priority', '?')}, Duration {task.get('duration_minutes', '?')} min)")
                ~~~~^^^^^^^^
  File "C:\Users\Mike\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\series.py", line 1133, in __getitem__
    return self._get_value(key)
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mike\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\series.py", line 1249, in _get_value
    loc = self.index.get_loc(label)
          ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mike\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'task'

[Scheduler Env Preflight]
  SUPABASE_URL: https:…e.co
  SUPABASE_SERVICE_ROLE_KEY: <missing>
  SUPABASE_SERVICE_KEY:      eyJhbG…SxCc
[Env OK]

Filtered out 0 template task(s).
No room inside window for 'Clear leaves' [14:00–17:00]; deferring.
No room inside window for 'Clear grotto' [14:00–16:30]; deferring.

============================================================
2 floating tasks could not be scheduled today:
[04/11/2025  7:05:06.71] DONE 
2025-11-04 08:08:09,181 INFO DayFlow scheduler starting (tz=Europe/London, dry_run=False, force=False)
2025-11-04 08:08:10,015 INFO Supabase client created.
2025-11-04 08:08:10,015 INFO Run date = 2025-11-04 (Europe/London local)
2025-11-04 08:08:10,553 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/task_templates?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39 "HTTP/2 200 OK"
2025-11-04 08:08:10,557 INFO templates: fetched 13 row(s) for user_id=3c877140-9539-47b9-898a-45eeab392e39
2025-11-04 08:08:10,557 INFO templates: columns=['id', 'user_id', 'title', 'description', 'kind', 'repeat', 'repeat_day', 'suggested_duration_minutes', 'origin_source', 'created_at', 'updated_at', 'active', 'repeat_interval', 'repeat_days', 'day_of_month', 'timezone', 'repeat_unit', 'start_time', 'duration_minutes', 'is_routine', 'is_fixed', 'is_appointment', 'notes', 'date', 'priority', 'window_start_local', 'window_end_local']
2025-11-04 08:08:10,561 INFO templates: preview (up to 5)=[{'id': '18390d4d-1798-4d3c-ab71-521ad9563276', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [1], 'start_time': None, 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'd2671250-aa7c-413c-9e52-76fb6b53f508', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [0], 'start_time': None, 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none', 'repeat': None, 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 5, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'daily', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 60, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'daily', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 45, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}]
2025-11-04 08:08:10,650 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=in.%282025-11-03%2C2025-11-04%29 "HTTP/2 200 OK"
2025-11-04 08:08:10,697 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-04 "HTTP/2 200 OK"
2025-11-04 08:08:10,747 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks_archive?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-04 "HTTP/2 200 OK"
2025-11-04 08:08:10,750 INFO One-off block list (template_id,title,repeat_unit): [{'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none'}, {'id': '237500d2-267b-498d-a840-3d907a94e7db', 'title': 'High priority task', 'repeat_unit': 'none'}, {'id': '642b62d0-4a8b-4ffe-bc1a-13cdcdad353d', 'title': 'Low priority task', 'repeat_unit': 'none'}, {'id': '5b16ec1e-8682-4287-8c57-9ada81185b62', 'title': 'Mr Roberts', 'repeat_unit': 'none'}, {'id': '0b2ea488-d48d-41fc-abb7-42f08cf80a8b', 'title': 'test floating task', 'repeat_unit': 'none'}]
2025-11-04 08:08:10,751 INFO Excluding 5 one-off template(s) already used on a different day
2025-11-04 08:08:10,772 INFO Instantiation report (7): [{'template_id': '18390d4d-1798-4d3c-ab71-521ad9563276', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [1], 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 30, 'reason': 'one-off today'}, {'template_id': 'd2671250-aa7c-413c-9e52-76fb6b53f508', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [0], 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 30, 'reason': 'one-off today'}, {'template_id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 60, 'reason': 'daily'}, {'template_id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 45, 'reason': 'daily'}, {'template_id': 'c8e62685-8b13-4922-92fe-420d38ba0d90', 'title': 'code d2', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 120, 'reason': 'daily'}, {'template_id': '209e8601-0b9f-42de-8a50-6406327d06fa', 'title': 'coffee', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T11:00:00+00:00', 'start_utc': '2025-11-04T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}, {'template_id': '7378ee44-b1e8-446d-a095-bfa6aa8c2b8b', 'title': 'routine test Wednesday', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T11:00:00+00:00', 'start_utc': '2025-11-04T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}]
2025-11-04 08:08:10,772 INFO Skip report (1): [{'template_id': 'e4dc2e80-0bda-49e7-80b0-3205b5285b13', 'title': 'Spraying', 'reason': 'weekly not due today (dow=1, days=[4])'}]
2025-11-04 08:08:10,772 INFO Skip summary: {'weekly not due today (dow=1, days=[4])': 1}
2025-11-04 08:08:10,779 INFO Prepared 7 instance(s) for 2025-11-04
2025-11-04 08:08:10,779 INFO Prepared 7 instance(s) for 2025-11-04 (post-dedupe)
2025-11-04 08:08:10,779 INFO Preprocessed 7 instance(s).
C:\Projects\dayflow-scheduler\dayflow\planner.py:1251: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  tasks_df['is_floating'] = tasks_df['is_floating'].fillna(False).astype(bool)
2025-11-04 08:08:10,797 ERROR Runner crashed
Traceback (most recent call last):
  File "C:\Users\Mike\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'task'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Projects\dayflow-scheduler\dayflow\scheduler_main.py", line 349, in <module>
    sys.exit(main())
             ^^^^^^
  File "C:\Projects\dayflow-scheduler\dayflow\scheduler_main.py", line 331, in main
    schedule = schedule_day(
               ^^^^^^^^^^^^^
  File "C:\Projects\dayflow-scheduler\dayflow\planner.py", line 1456, in schedule_day
    print(f" - {task['task']} (Priority {task.get('priority', '?')}, Duration {task.get('duration_minutes', '?')} min)")
                ~~~~^^^^^^^^
  File "C:\Users\Mike\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\series.py", line 1133, in __getitem__
    return self._get_value(key)
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mike\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\series.py", line 1249, in _get_value
    loc = self.index.get_loc(label)
          ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mike\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'task'

[Scheduler Env Preflight]
  SUPABASE_URL: https:…e.co
  SUPABASE_SERVICE_ROLE_KEY: <missing>
  SUPABASE_SERVICE_KEY:      eyJhbG…SxCc
[Env OK]

Filtered out 0 template task(s).
No room inside window for 'Clear leaves' [14:00–17:00]; deferring.
No room inside window for 'Clear grotto' [14:00–16:30]; deferring.

============================================================
2 floating tasks could not be scheduled today:
[04/11/2025  8:08:10.90] DONE 
2025-11-04 08:29:16,043 INFO DayFlow scheduler starting (tz=Europe/London, dry_run=False, force=False)
2025-11-04 08:29:16,871 INFO Supabase client created.
2025-11-04 08:29:16,871 INFO Run date = 2025-11-04 (Europe/London local)
2025-11-04 08:29:18,395 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/task_templates?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39 "HTTP/2 200 OK"
2025-11-04 08:29:18,398 INFO templates: fetched 13 row(s) for user_id=3c877140-9539-47b9-898a-45eeab392e39
2025-11-04 08:29:18,398 INFO templates: columns=['id', 'user_id', 'title', 'description', 'kind', 'repeat', 'repeat_day', 'suggested_duration_minutes', 'origin_source', 'created_at', 'updated_at', 'active', 'repeat_interval', 'repeat_days', 'day_of_month', 'timezone', 'repeat_unit', 'start_time', 'duration_minutes', 'is_routine', 'is_fixed', 'is_appointment', 'notes', 'date', 'priority', 'window_start_local', 'window_end_local']
2025-11-04 08:29:18,401 INFO templates: preview (up to 5)=[{'id': '18390d4d-1798-4d3c-ab71-521ad9563276', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [1], 'start_time': None, 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'd2671250-aa7c-413c-9e52-76fb6b53f508', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [0], 'start_time': None, 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none', 'repeat': None, 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 5, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'daily', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 60, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'daily', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 45, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}]
2025-11-04 08:29:18,537 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=in.%282025-11-03%2C2025-11-04%29 "HTTP/2 200 OK"
2025-11-04 08:29:18,600 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-04 "HTTP/2 200 OK"
2025-11-04 08:29:18,670 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks_archive?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-04 "HTTP/2 200 OK"
2025-11-04 08:29:18,672 INFO One-off block list (template_id,title,repeat_unit): [{'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none'}, {'id': '237500d2-267b-498d-a840-3d907a94e7db', 'title': 'High priority task', 'repeat_unit': 'none'}, {'id': '642b62d0-4a8b-4ffe-bc1a-13cdcdad353d', 'title': 'Low priority task', 'repeat_unit': 'none'}, {'id': '5b16ec1e-8682-4287-8c57-9ada81185b62', 'title': 'Mr Roberts', 'repeat_unit': 'none'}, {'id': '0b2ea488-d48d-41fc-abb7-42f08cf80a8b', 'title': 'test floating task', 'repeat_unit': 'none'}]
2025-11-04 08:29:18,672 INFO Excluding 5 one-off template(s) already used on a different day
2025-11-04 08:29:18,693 INFO Instantiation report (7): [{'template_id': '18390d4d-1798-4d3c-ab71-521ad9563276', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [1], 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 30, 'reason': 'one-off today'}, {'template_id': 'd2671250-aa7c-413c-9e52-76fb6b53f508', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [0], 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 30, 'reason': 'one-off today'}, {'template_id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 60, 'reason': 'daily'}, {'template_id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 45, 'reason': 'daily'}, {'template_id': 'c8e62685-8b13-4922-92fe-420d38ba0d90', 'title': 'code d2', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T09:00:00+00:00', 'start_utc': '2025-11-04T09:00:00+00:00', 'duration_min': 120, 'reason': 'daily'}, {'template_id': '209e8601-0b9f-42de-8a50-6406327d06fa', 'title': 'coffee', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T11:00:00+00:00', 'start_utc': '2025-11-04T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}, {'template_id': '7378ee44-b1e8-446d-a095-bfa6aa8c2b8b', 'title': 'routine test Wednesday', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-04', 'today': '2025-11-04', 'start_local': '2025-11-04T11:00:00+00:00', 'start_utc': '2025-11-04T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}]
2025-11-04 08:29:18,693 INFO Skip report (1): [{'template_id': 'e4dc2e80-0bda-49e7-80b0-3205b5285b13', 'title': 'Spraying', 'reason': 'weekly not due today (dow=1, days=[4])'}]
2025-11-04 08:29:18,693 INFO Skip summary: {'weekly not due today (dow=1, days=[4])': 1}
2025-11-04 08:29:18,699 INFO Prepared 7 instance(s) for 2025-11-04
2025-11-04 08:29:18,699 INFO Prepared 7 instance(s) for 2025-11-04 (post-dedupe)
2025-11-04 08:29:18,700 INFO Preprocessed 7 instance(s).
C:\Projects\dayflow-scheduler\dayflow\planner.py:1251: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  tasks_df['is_floating'] = tasks_df['is_floating'].fillna(False).astype(bool)
2025-11-04 08:29:18,778 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-04 08:29:18,821 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-04 08:29:18,971 INFO HTTP Request: POST https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?on_conflict=user_id%2Clocal_date%2Ctemplate_id&columns=%22end_time%22%2C%22priority%22%2C%22template_id%22%2C%22is_routine%22%2C%22local_date%22%2C%22user_id%22%2C%22is_appointment%22%2C%22start_time%22%2C%22is_fixed%22%2C%22duration_minutes%22%2C%22title%22%2C%22timezone%22 "HTTP/2 201 Created"
2025-11-04 08:29:18,971 INFO Scheduled 5 item(s).

[Scheduler Env Preflight]
  SUPABASE_URL: https:…e.co
  SUPABASE_SERVICE_ROLE_KEY: <missing>
  SUPABASE_SERVICE_KEY:      eyJhbG…SxCc
[Env OK]

Filtered out 0 template task(s).
No room inside window for 'Clear leaves' [14:00–17:00]; deferring.
No room inside window for 'Clear grotto' [14:00–16:30]; deferring.

============================================================
2 floating tasks could not be scheduled today:
 - Clear leaves (Priority 3, Duration 45 min)
 - Clear grotto (Priority 3, Duration 60 min)
============================================================

schedule_day candidates=5 filtered=5 allowed_cols=['created_at', 'date', 'description', 'duration_minutes', 'end_time', 'id', 'is_appointment', 'is_completed', 'is_deleted', 'is_fixed', 'is_routine', 'last_completed_date', 'local_date', 'origin_template_id', 'priority', 'start_time', 'template_id', 'timezone', 'title', 'updated_at', 'user_id']
schedule_day first row sample: {'duration_minutes': 120,
 'end_time': '2025-11-04T09:00:00+00:00',
 'is_appointment': False,
 'is_fixed': False,
 'is_routine': False,
 'local_date': '2025-11-04',
 'priority': 3,
 'start_time': '2025-11-04T07:00:00+00:00',
 'template_id': 'c8e62685-8b13-4922-92fe-420d38ba0d90',
 'timezone': 'Europe/London',
 'title': 'code d2',
 'user_id': '3c877140-9539-47b9-898a-45eeab392e39'}
schedule_day: WRITING 5 row(s) to scheduled_tasks for 2025-11-04
schedule_day upserted=5 attempted=5 conflict_target=user_id,local_date,template_id
[04/11/2025  8:29:19.05] DONE 
2025-11-05 07:05:02,929 INFO DayFlow scheduler starting (tz=Europe/London, dry_run=False, force=False)
2025-11-05 07:05:03,813 INFO Supabase client created.
2025-11-05 07:05:03,813 INFO Run date = 2025-11-05 (Europe/London local)
2025-11-05 07:05:05,862 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/task_templates?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39 "HTTP/2 200 OK"
2025-11-05 07:05:05,865 INFO templates: fetched 17 row(s) for user_id=3c877140-9539-47b9-898a-45eeab392e39
2025-11-05 07:05:05,866 INFO templates: columns=['id', 'user_id', 'title', 'description', 'kind', 'repeat', 'repeat_day', 'suggested_duration_minutes', 'origin_source', 'created_at', 'updated_at', 'active', 'repeat_interval', 'repeat_days', 'day_of_month', 'timezone', 'repeat_unit', 'start_time', 'duration_minutes', 'is_routine', 'is_fixed', 'is_appointment', 'notes', 'date', 'priority', 'window_start_local', 'window_end_local']
2025-11-05 07:05:05,868 INFO templates: preview (up to 5)=[{'id': '18390d4d-1798-4d3c-ab71-521ad9563276', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [1], 'start_time': None, 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'd2671250-aa7c-413c-9e52-76fb6b53f508', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [0], 'start_time': None, 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '550e00be-c559-4425-a509-ad8c15d92133', 'title': 'Book Mahjong', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': [1], 'start_time': None, 'duration_minutes': 15, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none', 'repeat': None, 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 5, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'daily', 'repeat': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'start_time': None, 'duration_minutes': 60, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}]
2025-11-05 07:05:06,090 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=in.%282025-11-04%2C2025-11-05%29 "HTTP/2 200 OK"
2025-11-05 07:05:06,185 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-05 "HTTP/2 200 OK"
2025-11-05 07:05:06,285 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks_archive?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-05 "HTTP/2 200 OK"
2025-11-05 07:05:06,287 INFO One-off block list (template_id,title,repeat_unit): [{'id': '18390d4d-1798-4d3c-ab71-521ad9563276', 'title': 'Black bags', 'repeat_unit': 'none'}, {'id': 'd2671250-aa7c-413c-9e52-76fb6b53f508', 'title': 'Black bags', 'repeat_unit': 'none'}, {'id': '550e00be-c559-4425-a509-ad8c15d92133', 'title': 'Book Mahjong', 'repeat_unit': 'none'}, {'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none'}, {'id': '237500d2-267b-498d-a840-3d907a94e7db', 'title': 'High priority task', 'repeat_unit': 'none'}, {'id': '642b62d0-4a8b-4ffe-bc1a-13cdcdad353d', 'title': 'Low priority task', 'repeat_unit': 'none'}, {'id': '5b16ec1e-8682-4287-8c57-9ada81185b62', 'title': 'Mr Roberts', 'repeat_unit': 'none'}, {'id': 'b706de43-4d13-4058-9f82-2e7faab08e44', 'title': 'Pay bills', 'repeat_unit': 'none'}, {'id': '133915cc-6d6c-4eff-8476-d0969cb05e08', 'title': 'Singers', 'repeat_unit': 'none'}, {'id': '0b2ea488-d48d-41fc-abb7-42f08cf80a8b', 'title': 'test floating task', 'repeat_unit': 'none'}, {'id': '2cbe80cb-d32f-448b-9817-d8f082d2af29', 'title': 'Therapy homework', 'repeat_unit': 'none'}]
2025-11-05 07:05:06,288 INFO Excluding 11 one-off template(s) already used on a different day
2025-11-05 07:05:06,306 INFO Instantiation report (5): [{'template_id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-05', 'today': '2025-11-05', 'start_local': '2025-11-05T09:00:00+00:00', 'start_utc': '2025-11-05T09:00:00+00:00', 'duration_min': 60, 'reason': 'daily'}, {'template_id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-05', 'today': '2025-11-05', 'start_local': '2025-11-05T09:00:00+00:00', 'start_utc': '2025-11-05T09:00:00+00:00', 'duration_min': 45, 'reason': 'daily'}, {'template_id': 'c8e62685-8b13-4922-92fe-420d38ba0d90', 'title': 'code d2', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-05', 'today': '2025-11-05', 'start_local': '2025-11-05T09:00:00+00:00', 'start_utc': '2025-11-05T09:00:00+00:00', 'duration_min': 120, 'reason': 'daily'}, {'template_id': '209e8601-0b9f-42de-8a50-6406327d06fa', 'title': 'coffee', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-05', 'today': '2025-11-05', 'start_local': '2025-11-05T11:00:00+00:00', 'start_utc': '2025-11-05T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}, {'template_id': '7378ee44-b1e8-446d-a095-bfa6aa8c2b8b', 'title': 'routine test Wednesday', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-05', 'today': '2025-11-05', 'start_local': '2025-11-05T11:00:00+00:00', 'start_utc': '2025-11-05T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}]
2025-11-05 07:05:06,306 INFO Skip report (1): [{'template_id': 'e4dc2e80-0bda-49e7-80b0-3205b5285b13', 'title': 'Spraying', 'reason': 'weekly not due today (dow=2, days=[4])'}]
2025-11-05 07:05:06,306 INFO Skip summary: {'weekly not due today (dow=2, days=[4])': 1}
2025-11-05 07:05:06,312 INFO Prepared 5 instance(s) for 2025-11-05
2025-11-05 07:05:06,312 INFO Prepared 5 instance(s) for 2025-11-05 (post-dedupe)
2025-11-05 07:05:06,312 INFO Preprocessed 5 instance(s).
C:\Projects\dayflow-scheduler\dayflow\planner.py:1251: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  tasks_df['is_floating'] = tasks_df['is_floating'].fillna(False).astype(bool)
2025-11-05 07:05:06,420 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-05 07:05:06,491 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-05 07:05:06,706 INFO HTTP Request: POST https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?on_conflict=user_id%2Clocal_date%2Ctemplate_id&columns=%22local_date%22%2C%22priority%22%2C%22user_id%22%2C%22template_id%22%2C%22is_routine%22%2C%22is_fixed%22%2C%22start_time%22%2C%22timezone%22%2C%22duration_minutes%22%2C%22title%22%2C%22is_appointment%22%2C%22end_time%22 "HTTP/2 201 Created"
2025-11-05 07:05:06,707 INFO Scheduled 5 item(s).

[Scheduler Env Preflight]
  SUPABASE_URL: https:…e.co
  SUPABASE_SERVICE_ROLE_KEY: <missing>
  SUPABASE_SERVICE_KEY:      eyJhbG…SxCc
[Env OK]

Filtered out 0 template task(s).
schedule_day candidates=5 filtered=5 allowed_cols=['created_at', 'date', 'description', 'duration_minutes', 'end_time', 'id', 'is_appointment', 'is_completed', 'is_deleted', 'is_fixed', 'is_routine', 'last_completed_date', 'local_date', 'origin_template_id', 'priority', 'start_time', 'template_id', 'timezone', 'title', 'updated_at', 'user_id']
schedule_day first row sample: {'duration_minutes': 120,
 'end_time': '2025-11-05T10:00:00+00:00',
 'is_appointment': False,
 'is_fixed': False,
 'is_routine': False,
 'local_date': '2025-11-05',
 'priority': 3,
 'start_time': '2025-11-05T08:00:00+00:00',
 'template_id': 'c8e62685-8b13-4922-92fe-420d38ba0d90',
 'timezone': 'Europe/London',
 'title': 'code d2',
 'user_id': '3c877140-9539-47b9-898a-45eeab392e39'}
schedule_day: WRITING 5 row(s) to scheduled_tasks for 2025-11-05
schedule_day upserted=5 attempted=5 conflict_target=user_id,local_date,template_id
[05/11/2025  7:05:06.79] DONE 
2025-11-06 07:05:03,057 INFO DayFlow scheduler starting (tz=Europe/London, dry_run=False, force=False)
2025-11-06 07:05:03,976 INFO Supabase client created.
2025-11-06 07:05:03,976 INFO Run date = 2025-11-06 (Europe/London local)
2025-11-06 07:05:06,168 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/task_templates?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39 "HTTP/2 200 OK"
2025-11-06 07:05:06,171 INFO templates: fetched 20 row(s) for user_id=3c877140-9539-47b9-898a-45eeab392e39
2025-11-06 07:05:06,171 INFO templates: columns=['id', 'user_id', 'title', 'description', 'kind', 'repeat', 'repeat_day', 'suggested_duration_minutes', 'origin_source', 'created_at', 'updated_at', 'active', 'repeat_interval', 'repeat_days', 'day_of_month', 'timezone', 'repeat_unit', 'start_time', 'duration_minutes', 'is_routine', 'is_fixed', 'is_appointment', 'notes', 'date', 'priority', 'window_start_local', 'window_end_local']
2025-11-06 07:05:06,175 INFO templates: preview (up to 5)=[{'id': '6da2dd7a-d937-44c6-9ef5-5dd955fdd739', 'title': 'Antonia', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': [2], 'start_time': '10:00:00', 'duration_minutes': 60, 'is_appointment': True, 'is_fixed': True, 'is_routine': False, 'timezone': 'Europe/London', 'date': '2025-11-05'}, {'id': '2d7fd5d1-9da2-45cf-bd3a-62843e89c351', 'title': 'Barbershop', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': [2], 'start_time': '19:30:00', 'duration_minutes': 180, 'is_appointment': True, 'is_fixed': True, 'is_routine': False, 'timezone': 'Europe/London', 'date': '2025-11-05'}, {'id': '18390d4d-1798-4d3c-ab71-521ad9563276', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [1], 'start_time': None, 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'd2671250-aa7c-413c-9e52-76fb6b53f508', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [0], 'start_time': None, 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '550e00be-c559-4425-a509-ad8c15d92133', 'title': 'Book Mahjong', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': [1], 'start_time': None, 'duration_minutes': 15, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}]
2025-11-06 07:05:06,407 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=in.%282025-11-05%2C2025-11-06%29 "HTTP/2 200 OK"
2025-11-06 07:05:06,582 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-06 "HTTP/2 200 OK"
2025-11-06 07:05:06,801 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks_archive?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-06 "HTTP/2 200 OK"
2025-11-06 07:05:06,803 INFO One-off block list (template_id,title,repeat_unit): [{'id': '6da2dd7a-d937-44c6-9ef5-5dd955fdd739', 'title': 'Antonia', 'repeat_unit': 'none'}, {'id': '18390d4d-1798-4d3c-ab71-521ad9563276', 'title': 'Black bags', 'repeat_unit': 'none'}, {'id': 'd2671250-aa7c-413c-9e52-76fb6b53f508', 'title': 'Black bags', 'repeat_unit': 'none'}, {'id': '550e00be-c559-4425-a509-ad8c15d92133', 'title': 'Book Mahjong', 'repeat_unit': 'none'}, {'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none'}, {'id': '44c31187-1a50-411a-a0d3-72384517edf1', 'title': 'finalise Ocado order', 'repeat_unit': 'none'}, {'id': '237500d2-267b-498d-a840-3d907a94e7db', 'title': 'High priority task', 'repeat_unit': 'none'}, {'id': '642b62d0-4a8b-4ffe-bc1a-13cdcdad353d', 'title': 'Low priority task', 'repeat_unit': 'none'}, {'id': '5b16ec1e-8682-4287-8c57-9ada81185b62', 'title': 'Mr Roberts', 'repeat_unit': 'none'}, {'id': 'b706de43-4d13-4058-9f82-2e7faab08e44', 'title': 'Pay bills', 'repeat_unit': 'none'}, {'id': '133915cc-6d6c-4eff-8476-d0969cb05e08', 'title': 'Singers', 'repeat_unit': 'none'}, {'id': '0b2ea488-d48d-41fc-abb7-42f08cf80a8b', 'title': 'test floating task', 'repeat_unit': 'none'}, {'id': '2cbe80cb-d32f-448b-9817-d8f082d2af29', 'title': 'Therapy homework', 'repeat_unit': 'none'}]
2025-11-06 07:05:06,803 INFO Excluding 13 one-off template(s) already used on a different day
2025-11-06 07:05:06,813 INFO Patching origin_template_id for completed task 'routine test Wednesday'
2025-11-06 07:05:06,822 INFO Instantiation report (5): [{'template_id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-06', 'today': '2025-11-06', 'start_local': '2025-11-06T09:00:00+00:00', 'start_utc': '2025-11-06T09:00:00+00:00', 'duration_min': 60, 'reason': 'daily'}, {'template_id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-06', 'today': '2025-11-06', 'start_local': '2025-11-06T09:00:00+00:00', 'start_utc': '2025-11-06T09:00:00+00:00', 'duration_min': 45, 'reason': 'daily'}, {'template_id': 'c8e62685-8b13-4922-92fe-420d38ba0d90', 'title': 'code d2', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-06', 'today': '2025-11-06', 'start_local': '2025-11-06T09:00:00+00:00', 'start_utc': '2025-11-06T09:00:00+00:00', 'duration_min': 120, 'reason': 'daily'}, {'template_id': '209e8601-0b9f-42de-8a50-6406327d06fa', 'title': 'coffee', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-06', 'today': '2025-11-06', 'start_local': '2025-11-06T11:00:00+00:00', 'start_utc': '2025-11-06T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}, {'template_id': '7378ee44-b1e8-446d-a095-bfa6aa8c2b8b', 'title': 'routine test Wednesday', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-06', 'today': '2025-11-06', 'start_local': '2025-11-06T11:00:00+00:00', 'start_utc': '2025-11-06T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}]
2025-11-06 07:05:06,823 INFO Skip report (2): [{'template_id': '2d7fd5d1-9da2-45cf-bd3a-62843e89c351', 'title': 'Barbershop', 'reason': 'one-off not today (date=2025-11-05, today=2025-11-06)'}, {'template_id': 'e4dc2e80-0bda-49e7-80b0-3205b5285b13', 'title': 'Spraying', 'reason': 'weekly not due today (dow=3, days=[4])'}]
2025-11-06 07:05:06,823 INFO Skip summary: {'one-off not today (date=2025-11-05, today=2025-11-06)': 1, 'weekly not due today (dow=3, days=[4])': 1}
2025-11-06 07:05:06,829 INFO Prepared 5 instance(s) for 2025-11-06
2025-11-06 07:05:06,829 INFO Prepared 5 instance(s) for 2025-11-06 (post-dedupe)
2025-11-06 07:05:06,829 INFO Preprocessed 5 instance(s).
2025-11-06 07:05:06,993 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id&local_date=eq.2025-11-06&is_deleted=eq.True&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39 "HTTP/2 200 OK"
C:\Projects\dayflow-scheduler\dayflow\planner.py:1251: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  tasks_df['is_floating'] = tasks_df['is_floating'].fillna(False).astype(bool)
2025-11-06 07:05:07,184 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-06 07:05:07,298 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-06 07:05:07,494 INFO HTTP Request: POST https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?on_conflict=user_id%2Clocal_date%2Ctemplate_id&columns=%22is_appointment%22%2C%22is_routine%22%2C%22start_time%22%2C%22priority%22%2C%22timezone%22%2C%22end_time%22%2C%22duration_minutes%22%2C%22template_id%22%2C%22user_id%22%2C%22is_fixed%22%2C%22local_date%22%2C%22title%22 "HTTP/2 201 Created"
2025-11-06 07:05:07,496 INFO Scheduled 5 item(s).
2025-11-06 07:05:07,759 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=user_id%2Ctitle%2Ctemplate_id%2Cduration_minutes%2Cpriority%2Cis_appointment%2Cis_routine%2Cis_fixed%2Ctimezone&local_date=eq.2025-11-05&is_deleted=eq.False&is_completed=eq.False&is_appointment=eq.False&is_routine=eq.False "HTTP/2 200 OK"
2025-11-06 07:05:07,963 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/task_templates?select=id%2Crepeat_unit%2Crepeat%2Crepeat_interval%2Crepeat_days&id=in.%280c68a092-2205-4633-8ce3-7f2c91bf8deb%29 "HTTP/2 200 OK"
2025-11-06 07:05:08,038 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id&local_date=eq.2025-11-06 "HTTP/2 200 OK"

[Scheduler Env Preflight]
  SUPABASE_URL: https:…e.co
  SUPABASE_SERVICE_ROLE_KEY: <missing>
  SUPABASE_SERVICE_KEY:      eyJhbG…SxCc
[Env OK]

Filtered out 0 template task(s).
schedule_day candidates=5 filtered=5 allowed_cols=['created_at', 'date', 'description', 'duration_minutes', 'end_time', 'id', 'is_appointment', 'is_completed', 'is_deleted', 'is_fixed', 'is_routine', 'last_completed_date', 'local_date', 'origin_template_id', 'priority', 'start_time', 'template_id', 'timezone', 'title', 'updated_at', 'user_id']
schedule_day first row sample: {'duration_minutes': 120,
 'end_time': '2025-11-06T10:00:00+00:00',
 'is_appointment': False,
 'is_fixed': False,
 'is_routine': False,
 'local_date': '2025-11-06',
 'priority': 3,
 'start_time': '2025-11-06T08:00:00+00:00',
 'template_id': 'c8e62685-8b13-4922-92fe-420d38ba0d90',
 'timezone': 'Europe/London',
 'title': 'code d2',
 'user_id': '3c877140-9539-47b9-898a-45eeab392e39'}
schedule_day: WRITING 5 row(s) to scheduled_tasks for 2025-11-06
schedule_day upserted=5 attempted=5 conflict_target=user_id,local_date,template_id
[carry_forward] Nothing to insert.
[06/11/2025  7:05:08.13] DONE 
2025-11-07 07:05:09,021 INFO DayFlow scheduler starting (tz=Europe/London, dry_run=False, force=False)
2025-11-07 07:05:12,755 INFO Supabase client created.
2025-11-07 07:05:12,755 INFO Run date = 2025-11-07 (Europe/London local)
2025-11-07 07:05:14,885 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/task_templates?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39 "HTTP/2 200 OK"
2025-11-07 07:05:14,990 INFO templates: fetched 22 row(s) for user_id=3c877140-9539-47b9-898a-45eeab392e39
2025-11-07 07:05:14,990 INFO templates: columns=['id', 'user_id', 'title', 'description', 'kind', 'repeat', 'repeat_day', 'suggested_duration_minutes', 'origin_source', 'created_at', 'updated_at', 'active', 'repeat_interval', 'repeat_days', 'day_of_month', 'timezone', 'repeat_unit', 'start_time', 'duration_minutes', 'is_routine', 'is_fixed', 'is_appointment', 'notes', 'date', 'priority', 'window_start_local', 'window_end_local']
2025-11-07 07:05:15,089 INFO templates: preview (up to 5)=[{'id': '6da2dd7a-d937-44c6-9ef5-5dd955fdd739', 'title': 'Antonia', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': [2], 'start_time': '10:00:00', 'duration_minutes': 60, 'is_appointment': True, 'is_fixed': True, 'is_routine': False, 'timezone': 'Europe/London', 'date': '2025-11-05'}, {'id': '2d7fd5d1-9da2-45cf-bd3a-62843e89c351', 'title': 'Barbershop', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': [2], 'start_time': '19:30:00', 'duration_minutes': 180, 'is_appointment': True, 'is_fixed': True, 'is_routine': False, 'timezone': 'Europe/London', 'date': '2025-11-05'}, {'id': '18390d4d-1798-4d3c-ab71-521ad9563276', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [1], 'start_time': None, 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': 'd2671250-aa7c-413c-9e52-76fb6b53f508', 'title': 'Black bags', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 2, 'repeat_day': None, 'repeat_days': [0], 'start_time': None, 'duration_minutes': 30, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}, {'id': '550e00be-c559-4425-a509-ad8c15d92133', 'title': 'Book Mahjong', 'repeat_unit': 'none', 'repeat': 'weekly', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': [1], 'start_time': None, 'duration_minutes': 15, 'is_appointment': False, 'is_fixed': False, 'is_routine': False, 'timezone': 'Europe/London', 'date': None}]
2025-11-07 07:05:15,345 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=in.%282025-11-06%2C2025-11-07%29 "HTTP/2 200 OK"
2025-11-07 07:05:15,504 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-07 "HTTP/2 200 OK"
2025-11-07 07:05:15,690 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks_archive?select=template_id%2Clocal_date&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39&local_date=neq.2025-11-07 "HTTP/2 200 OK"
2025-11-07 07:05:15,694 INFO One-off block list (template_id,title,repeat_unit): [{'id': '6da2dd7a-d937-44c6-9ef5-5dd955fdd739', 'title': 'Antonia', 'repeat_unit': 'none'}, {'id': '18390d4d-1798-4d3c-ab71-521ad9563276', 'title': 'Black bags', 'repeat_unit': 'none'}, {'id': 'd2671250-aa7c-413c-9e52-76fb6b53f508', 'title': 'Black bags', 'repeat_unit': 'none'}, {'id': '550e00be-c559-4425-a509-ad8c15d92133', 'title': 'Book Mahjong', 'repeat_unit': 'none'}, {'id': 'c013f8b1-77d9-4fe0-95ff-3d1ad6ca3ea2', 'title': 'CANARY – template', 'repeat_unit': 'none'}, {'id': '44c31187-1a50-411a-a0d3-72384517edf1', 'title': 'finalise Ocado order', 'repeat_unit': 'none'}, {'id': '237500d2-267b-498d-a840-3d907a94e7db', 'title': 'High priority task', 'repeat_unit': 'none'}, {'id': '642b62d0-4a8b-4ffe-bc1a-13cdcdad353d', 'title': 'Low priority task', 'repeat_unit': 'none'}, {'id': '82885591-1a30-42f6-b51d-e337c489793b', 'title': 'Mah Jong', 'repeat_unit': 'none'}, {'id': 'ef346653-bca5-4133-8fed-8221b6cf64dc', 'title': 'Maj Jong', 'repeat_unit': 'none'}, {'id': '5b16ec1e-8682-4287-8c57-9ada81185b62', 'title': 'Mr Roberts', 'repeat_unit': 'none'}, {'id': 'b706de43-4d13-4058-9f82-2e7faab08e44', 'title': 'Pay bills', 'repeat_unit': 'none'}, {'id': '133915cc-6d6c-4eff-8476-d0969cb05e08', 'title': 'Singers', 'repeat_unit': 'none'}, {'id': '0b2ea488-d48d-41fc-abb7-42f08cf80a8b', 'title': 'test floating task', 'repeat_unit': 'none'}, {'id': '2cbe80cb-d32f-448b-9817-d8f082d2af29', 'title': 'Therapy homework', 'repeat_unit': 'none'}]
2025-11-07 07:05:15,711 INFO Excluding 15 one-off template(s) already used on a different day
2025-11-07 07:05:15,785 INFO Instantiation report (6): [{'template_id': 'f7fdd0e6-c96b-4a88-b792-5dccbfa27efa', 'title': 'Clear grotto', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-07', 'today': '2025-11-07', 'start_local': '2025-11-07T09:00:00+00:00', 'start_utc': '2025-11-07T09:00:00+00:00', 'duration_min': 60, 'reason': 'daily'}, {'template_id': '0c68a092-2205-4633-8ce3-7f2c91bf8deb', 'title': 'Clear leaves', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-07', 'today': '2025-11-07', 'start_local': '2025-11-07T09:00:00+00:00', 'start_utc': '2025-11-07T09:00:00+00:00', 'duration_min': 45, 'reason': 'daily'}, {'template_id': 'c8e62685-8b13-4922-92fe-420d38ba0d90', 'title': 'code d2', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-07', 'today': '2025-11-07', 'start_local': '2025-11-07T09:00:00+00:00', 'start_utc': '2025-11-07T09:00:00+00:00', 'duration_min': 120, 'reason': 'daily'}, {'template_id': '209e8601-0b9f-42de-8a50-6406327d06fa', 'title': 'coffee', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-07', 'today': '2025-11-07', 'start_local': '2025-11-07T11:00:00+00:00', 'start_utc': '2025-11-07T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}, {'template_id': '7378ee44-b1e8-446d-a095-bfa6aa8c2b8b', 'title': 'routine test Wednesday', 'repeat_unit': 'daily', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': None, 'reference_date': '2025-11-07', 'today': '2025-11-07', 'start_local': '2025-11-07T11:00:00+00:00', 'start_utc': '2025-11-07T11:00:00+00:00', 'duration_min': 30, 'reason': 'daily'}, {'template_id': 'e4dc2e80-0bda-49e7-80b0-3205b5285b13', 'title': 'Spraying', 'repeat_unit': 'weekly', 'repeat_interval': 1, 'repeat_day': None, 'repeat_days': [4], 'reference_date': '2025-11-07', 'today': '2025-11-07', 'start_local': '2025-11-07T09:00:00+00:00', 'start_utc': '2025-11-07T09:00:00+00:00', 'duration_min': 45, 'reason': 'weekly (weeks_since=0, interval=1, dow=4, days=[4])'}]
2025-11-07 07:05:15,785 INFO Skip report (1): [{'template_id': '2d7fd5d1-9da2-45cf-bd3a-62843e89c351', 'title': 'Barbershop', 'reason': 'one-off not today (date=2025-11-05, today=2025-11-07)'}]
2025-11-07 07:05:15,785 INFO Skip summary: {'one-off not today (date=2025-11-05, today=2025-11-07)': 1}
2025-11-07 07:05:15,791 INFO Prepared 6 instance(s) for 2025-11-07
2025-11-07 07:05:15,791 INFO Prepared 6 instance(s) for 2025-11-07 (post-dedupe)
2025-11-07 07:05:15,791 INFO Preprocessed 6 instance(s).
2025-11-07 07:05:15,880 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id&local_date=eq.2025-11-07&is_deleted=eq.True&user_id=eq.3c877140-9539-47b9-898a-45eeab392e39 "HTTP/2 200 OK"
C:\Projects\dayflow-scheduler\dayflow\planner.py:1251: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  tasks_df['is_floating'] = tasks_df['is_floating'].fillna(False).astype(bool)
2025-11-07 07:05:16,055 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-07 07:05:16,154 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=%2A&limit=1 "HTTP/2 200 OK"
2025-11-07 07:05:16,406 INFO HTTP Request: POST https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?on_conflict=user_id%2Clocal_date%2Ctemplate_id&columns=%22priority%22%2C%22title%22%2C%22duration_minutes%22%2C%22template_id%22%2C%22is_fixed%22%2C%22timezone%22%2C%22is_routine%22%2C%22local_date%22%2C%22is_appointment%22%2C%22start_time%22%2C%22end_time%22%2C%22user_id%22 "HTTP/2 201 Created"
2025-11-07 07:05:16,407 INFO Scheduled 6 item(s).
2025-11-07 07:05:16,471 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=user_id%2Ctitle%2Ctemplate_id%2Cduration_minutes%2Cpriority%2Cis_appointment%2Cis_routine%2Cis_fixed%2Ctimezone&local_date=eq.2025-11-06&is_deleted=eq.False&is_completed=eq.False&is_appointment=eq.False&is_routine=eq.False "HTTP/2 200 OK"
2025-11-07 07:05:16,529 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/task_templates?select=id%2Crepeat_unit%2Crepeat%2Crepeat_interval%2Crepeat_days&id=in.%280c68a092-2205-4633-8ce3-7f2c91bf8deb%2Cf7fdd0e6-c96b-4a88-b792-5dccbfa27efa%29 "HTTP/2 200 OK"
2025-11-07 07:05:16,568 INFO HTTP Request: GET https://prloxvewcsxaptzgxvyy.supabase.co/rest/v1/scheduled_tasks?select=template_id&local_date=eq.2025-11-07 "HTTP/2 200 OK"

[Scheduler Env Preflight]
  SUPABASE_URL: https:…e.co
  SUPABASE_SERVICE_ROLE_KEY: <missing>
  SUPABASE_SERVICE_KEY:      eyJhbG…SxCc
[Env OK]

Filtered out 0 template task(s).
schedule_day candidates=6 filtered=6 allowed_cols=['created_at', 'date', 'description', 'duration_minutes', 'end_time', 'id', 'is_appointment', 'is_completed', 'is_deleted', 'is_fixed', 'is_routine', 'last_completed_date', 'local_date', 'origin_template_id', 'priority', 'start_time', 'template_id', 'timezone', 'title', 'updated_at', 'user_id']
schedule_day first row sample: {'duration_minutes': 45,
 'end_time': '2025-11-07T08:45:00+00:00',
 'is_appointment': False,
 'is_fixed': False,
 'is_routine': False,
 'local_date': '2025-11-07',
 'priority': 3,
 'start_time': '2025-11-07T08:00:00+00:00',
 'template_id': 'e4dc2e80-0bda-49e7-80b0-3205b5285b13',
 'timezone': 'Europe/London',
 'title': 'Spraying',
 'user_id': '3c877140-9539-47b9-898a-45eeab392e39'}
schedule_day: WRITING 6 row(s) to scheduled_tasks for 2025-11-07
schedule_day upserted=6 attempted=6 conflict_target=user_id,local_date,template_id
[carry_forward] Nothing to insert.
[07/11/2025  7:05:16.68] DONE 
